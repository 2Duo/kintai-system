{% extends 'base.html' %}
{% block title %}アップデート{% endblock %}
{% block content %}
<h1 class="mb-3">アップデート</h1>
{% if system_info and system_info.commits %}
  {% set commits = system_info.commits %}
  {% if commits.error %}
    <div class="alert alert-danger">{{ commits.error }}</div>
  {% else %}
    <p>現在のコミット: <code>{{ commits.current[:8] if commits.current else 'Unknown' }}</code></p>
    {% if commits.latest %}
      <p>最新のコミット: <code>{{ commits.latest[:8] }}</code></p>
      {% if system_info.has_updates %}
        <div class="alert alert-warning">更新があります。</div>
        <form method="POST">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="btn btn-primary">アップデート実行</button>
        </form>
        {% if commits.behind %}
          <details class="mt-3"><summary>更新内容 ({{ commits.behind|length }}件)</summary>
          <ul>
          {% for commit in commits.behind %}
            <li><code>{{ commit.hash[:8] }}</code> - {{ commit.message }}</li>
          {% endfor %}
          </ul>
          </details>
        {% endif %}
      {% else %}
        <div class="alert alert-success">最新版です。</div>
      {% endif %}
    {% endif %}
  {% endif %}
{% else %}
  <div class="alert alert-warning">Git情報を取得できませんでした。</div>
{% endif %}
{% endblock %}

